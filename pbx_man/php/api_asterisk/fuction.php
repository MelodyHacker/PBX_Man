<?php

function checkPjsip($sip){
	$session_file = rand();
	$status = "";

	exec("cat /etc/asterisk/iconnect/pjsip.conf |grep usernam > /var/www/html/dev/log/member_" . $session_file);
	exec("cat /etc/asterisk/iconnect/member_pjsip_api.conf |grep username >> /var/www/html/dev/log/member_" . $session_file);
	$ar_data = readFiles("/var/www/html/dev/log/member_" . $session_file);		
	exec("rm /var/www/html/dev/log/member_" . $session_file);	
	return searchArray("username = " . $sip, $ar_data);


}
//////////////////////////////////////////////////////////////////////////
function searchArray($value, $array) 
{ 
	return(array_search($value, $array, TRUE)); 
} 
//////////////////////////////////////////////////////////////////////////
function reloadPjsip(){

	$socket = fsockopen("localhost","5038", $errno, $errstr, 10);
	fputs($socket, "Action:Login\r\n");
	fputs($socket, "UserName:iconnect\r\n");
	fputs($socket, "Secret:)CT^G)N0ct6g0n\r\n\r\n");
	fputs($socket, "Action: Command\r\n");
	fputs($socket, "Command: pjsip reload\r\n");
	fputs($socket, "Action: Logoff\r\n\r\n");
	feof($socket);
	sleep(5);
	fclose($socket);
}
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
function writeFiles($data,$where){
	$fp = fopen($where, 'a');
	fwrite($fp, $data);
}
//////////////////////////////////////////////////////////////////////////
function readFiles($where){
	$data = array();
	if ($fh = fopen($where, 'r')) {
		while (!feof($fh)) {
			$line = fgets($fh);
			$line = str_replace("\n","",$line);
			array_push($data,$line);
		}
		fclose($fh);
	} 
	return $data;
}
?>
